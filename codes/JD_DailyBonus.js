/**
 * 更新时间: 2021.06.17 23:20 v2.0.5
 * Author：GitHub@NobyDa
 */
var Key="",DualKey="",OtherKey="",LogDetails=!1,stop="0",DeleteCookie=!1,boxdis=!0,ReDis=!1,out=0,$nobyda=nobyda();async function all(){switch(merge={},stop){case 0:await Promise.all([JingDongBean(stop),JingDongStore(stop),JingRongSteel(stop),JingDongTurn(stop),JDFlashSale(stop),JingDongCash(stop),JDMagicCube(stop,2),JingDongSubsidy(stop),JingDongGetCash(stop),JingDongShake(stop),JDSecKilling(stop),JingDongBuyCar(stop,"435c9611622e4135b436b9d73351be10"),JingRongDoll(stop,"JRFourDoll","京东金融-签肆","30C4F86264")]),await Promise.all([JDUserSignPre(stop,"JDUndies","京东商城-内衣","4PgpL1xqPSW1sVXCJ3xopDbB1f69"),JDUserSignPre(stop,"JDCard","京东商城-卡包","7e5fRnma6RBATV9wNrGXJwihzcD"),JDUserSignPre(stop,"JDaccompany","京东商城-陪伴","kPM3Xedz1PBiGQjY4ZYGmeVvrts"),JDUserSignPre(stop,"JDShoes","京东商城-鞋靴","4RXyb1W4Y986LJW8ToqMK14BdTD"),JDUserSignPre(stop,"JDChild","京东商城-童装","3Af6mZNcf5m795T8dtDVfDwWVNhJ"),JDUserSignPre(stop,"JDBaby","京东商城-母婴","3BbAVGQPDd6vTyHYjmAutXrKAos6"),JDUserSignPre(stop,"JD3C","京东商城-数码","4SWjnZSCTHPYjE5T7j35rxxuMTb6"),JDUserSignPre(stop,"JDWomen","京东商城-女装","DpSh7ma8JV7QAxSE2gJNro8Q2h9"),JDUserSignPre(stop,"JDBook","京东商城-图书","3SC6rw5iBg66qrXPGmZMqFDwcyXi"),JingRongDoll(stop,"JTDouble","京东金贴-双签","1DF13833F7")]),await Promise.all([JDUserSignPre(stop,"JDEsports","京东商城-电竞","CHdHQhA5AYDXXQN9FLt3QUAPRsB"),JDUserSignPre(stop,"JDClothing","京东商城-服饰","4RBT3H9jmgYg1k2kBnHF8NAHm7m8"),JDUserSignPre(stop,"JDSuitcase","京东商城-箱包","ZrH7gGAcEkY2gH8wXqyAPoQgk6t"),JDUserSignPre(stop,"JDSchool","京东商城-校园","2QUxWHx5BSCNtnBDjtt5gZTq7zdZ"),JDUserSignPre(stop,"JDHealth","京东商城-健康","w2oeK5yLdHqHvwef7SMMy4PL8LF"),JDUserSignPre(stop,"JDShand","京东拍拍-二手","3S28janPLYmtFxypu37AYAGgivfp"),JDUserSignPre(stop,"JDClean","京东商城-清洁","2Tjm6ay1ZbZ3v7UbriTj6kHy9dn6"),JDUserSignPre(stop,"JDCare","京东商城-个护","2tZssTgnQsiUqhmg5ooLSHY9XSeN"),JDUserSignPre(stop,"JDVege","京东商城-菜场","Wcu2LVCFMkBP3HraRvb7pgSpt64")]),await JingRongDoll(stop,"JDDouble","金融京豆-双签","F68B2C3E71","","","","jingdou");break;default:await JingDongBean(0),await JingDongStore(Wait(stop)),await JingRongSteel(Wait(stop)),await JingDongTurn(Wait(stop)),await JDFlashSale(Wait(stop)),await JingDongCash(Wait(stop)),await JDMagicCube(Wait(stop),2),await JingDongGetCash(Wait(stop)),await JingDongSubsidy(Wait(stop)),await JingDongShake(Wait(stop)),await JDSecKilling(Wait(stop)),await JingDongBuyCar(Wait(stop),"435c9611622e4135b436b9d73351be10"),await JingRongDoll(Wait(stop),"JRFourDoll","京东金融-签肆","30C4F86264"),await JingRongDoll(Wait(stop),"JTDouble","京东金贴-双签","1DF13833F7"),await JDUserSignPre(Wait(stop),"JDCard","京东商城-卡包","7e5fRnma6RBATV9wNrGXJwihzcD"),await JDUserSignPre(Wait(stop),"JDUndies","京东商城-内衣","4PgpL1xqPSW1sVXCJ3xopDbB1f69"),await JDUserSignPre(Wait(stop),"JDEsports","京东商城-电竞","CHdHQhA5AYDXXQN9FLt3QUAPRsB"),await JDUserSignPre(Wait(stop),"JDSuitcase","京东商城-箱包","ZrH7gGAcEkY2gH8wXqyAPoQgk6t"),await JDUserSignPre(Wait(stop),"JDClothing","京东商城-服饰","4RBT3H9jmgYg1k2kBnHF8NAHm7m8"),await JDUserSignPre(Wait(stop),"JDSchool","京东商城-校园","2QUxWHx5BSCNtnBDjtt5gZTq7zdZ"),await JDUserSignPre(Wait(stop),"JDHealth","京东商城-健康","w2oeK5yLdHqHvwef7SMMy4PL8LF"),await JDUserSignPre(Wait(stop),"JDShoes","京东商城-鞋靴","4RXyb1W4Y986LJW8ToqMK14BdTD"),await JDUserSignPre(Wait(stop),"JDChild","京东商城-童装","3Af6mZNcf5m795T8dtDVfDwWVNhJ"),await JDUserSignPre(Wait(stop),"JDBaby","京东商城-母婴","3BbAVGQPDd6vTyHYjmAutXrKAos6"),await JDUserSignPre(Wait(stop),"JD3C","京东商城-数码","4SWjnZSCTHPYjE5T7j35rxxuMTb6"),await JDUserSignPre(Wait(stop),"JDWomen","京东商城-女装","DpSh7ma8JV7QAxSE2gJNro8Q2h9"),await JDUserSignPre(Wait(stop),"JDBook","京东商城-图书","3SC6rw5iBg66qrXPGmZMqFDwcyXi"),await JDUserSignPre(Wait(stop),"JDShand","京东拍拍-二手","3S28janPLYmtFxypu37AYAGgivfp"),await JDUserSignPre(Wait(stop),"JDVege","京东商城-菜场","Wcu2LVCFMkBP3HraRvb7pgSpt64"),await JDUserSignPre(Wait(stop),"JDaccompany","京东商城-陪伴","kPM3Xedz1PBiGQjY4ZYGmeVvrts"),await JDUserSignPre(Wait(stop),"JDClean","京东商城-清洁","2Tjm6ay1ZbZ3v7UbriTj6kHy9dn6"),await JDUserSignPre(Wait(stop),"JDCare","京东商城-个护","2tZssTgnQsiUqhmg5ooLSHY9XSeN"),await JingRongDoll(Wait(stop),"JDDouble","金融京豆-双签","F68B2C3E71","","","","jingdou")}await Promise.all([TotalSteel(),TotalCash(),TotalBean(),TotalSubsidy(),TotalMoney()]),await notify()}function notify(){return new Promise((e=>{try{var o=0,t=0,n=0,r=0,a=0,i=0,s=0,l=0,c="";for(var d in merge)o+=merge[d].bean?Number(merge[d].bean):0,t+=merge[d].steel?Number(merge[d].steel):0,n+=merge[d].Cash?Number(merge[d].Cash):0,r+=merge[d].Money?Number(merge[d].Money):0,a+=merge[d].subsidy?Number(merge[d].subsidy):0,i+=merge[d].success?Number(merge[d].success):0,s+=merge[d].fail?Number(merge[d].fail):0,l+=merge[d].error?Number(merge[d].error):0,c+=merge[d].notify?"\n"+merge[d].notify:"";var u=merge.TotalCash&&merge.TotalCash.TCash?merge.TotalCash.TCash+"红包":"",g=merge.TotalSteel&&merge.TotalSteel.TSteel?merge.TotalSteel.TSteel+"钢镚":"",m=merge.TotalBean&&merge.TotalBean.Qbear?`${merge.TotalBean.Qbear}京豆${g?", ":""}`:"",f=merge.TotalMoney&&merge.TotalMoney.TMoney?`${merge.TotalMoney.TMoney}现金${u?", ":""}`:"",y=merge.TotalSubsidy&&merge.TotalSubsidy.TSubsidy?`${merge.TotalSubsidy.TSubsidy}金贴${f||u?", ":""}`:"",D=o?`${o.toFixed(0)}京豆${t?", ":""}`:"",p=t?t.toFixed(2)+"钢镚":"",h=n?`${n.toFixed(2)}红包${a||r?", ":""}`:"",b=a?`${a.toFixed(2)}金贴${r?", ":""}`:"",J=r?r.toFixed(2)+"现金":"",$=i?`成功${i}个${s||l?", ":""}`:"",S=s?`失败${s}个${l?", ":""}`:"",C=l?`错误${l}个`:"",w=`【签到概览】:  ${$+S+C}${$||S||C?"\n":"获取失败\n"}`,T=D||p?`【签到奖励】:  ${D+p}\n`:"",k=h||b||J?`【其他奖励】:  ${h+b+J}\n`:"",A=`【账号总计】:  ${m+g}${m||g?"\n":"获取失败\n"}`,B=`【其他总计】:  ${y+f+u}${y||f||u?"\n":"获取失败\n"}`,P=merge.TotalBean&&merge.TotalBean.nickname?merge.TotalBean.nickname:"获取失败";const E=Key||DualKey?Key&&DualKey?DualAccount:DualAccount-1||DualAccount:DualAccount-2,K=DualKey||OtherKey?`【签到号${["零","一","二","三","四","五","六","七","八","九","十"][E]||E}】:  ${P}\n`:"",j=$nobyda.read("JD_DailyBonusDisables"),N=j?j.split(",").length:0,I=!c||N?`【温馨提示】:  检测到${$nobyda.disable?"上次执行意外崩溃, ":""}已禁用${c?N+"个":"所有"}接口, 如需开启请前往BoxJs或查看脚本内第100行注释.\n`:"";$nobyda.notify("","",K+w+T+k+A+B+I+c,{"media-url":$nobyda.headUrl||"https://cdn.jsdelivr.net/gh/NobyDa/mini@master/Color/jd.png"}),$nobyda.headUrl=null,$nobyda.isJSBox&&(Shortcut=("undefined"==typeof Shortcut?"":Shortcut)+K+w+T+k+A+B+"\n"),double()}catch(e){$nobyda.notify("通知模块 "+e.name+"‼️",JSON.stringify(e),e.message)}finally{e()}}))}function ReadCookie(){DualAccount=1;const e=$nobyda.isJSBox?"JD_Cookie":"CookieJD",o=$nobyda.isJSBox?"JD_Cookie2":"CookieJD2",t=$nobyda.isJSBox?"JD_Cookies":"CookiesJD";if(DeleteCookie)return $nobyda.read(e)||$nobyda.read(o)||"[]"!=($nobyda.read(t)||"[]")?($nobyda.write("",e),$nobyda.write("",o),$nobyda.write("",t),$nobyda.notify("京东Cookie清除成功 !","",'请手动关闭脚本内"DeleteCookie"选项'),void $nobyda.done()):($nobyda.notify("脚本终止","",'未关闭脚本内"DeleteCookie"选项 ‼️'),void $nobyda.done());$nobyda.isRequest?GetCookie():(Key=Key||$nobyda.read(e),DualKey=DualKey||$nobyda.read(o),OtherKey=OtherKey||$nobyda.read(t),KEY=Key||DualKey,KEY||OtherKey?(($nobyda.isJSBox||$nobyda.isNode)&&(Key&&$nobyda.write(Key,e),DualKey&&$nobyda.write(DualKey,o),OtherKey&&$nobyda.write(OtherKey,t),"0"!==stop&&$nobyda.write(stop,"JD_DailyBonusDelay")),out=parseInt($nobyda.read("JD_DailyBonusTimeOut"))||out,stop=Wait($nobyda.read("JD_DailyBonusDelay"),!0)||Wait(stop,!0),boxdis="false"!==$nobyda.read("JD_Crash_disable")&&!$nobyda.isNode&&!$nobyda.isJSBox&&boxdis,LogDetails="true"===$nobyda.read("JD_DailyBonusLog")||LogDetails,ReDis=ReDis?$nobyda.write("","JD_DailyBonusDisables"):"",KEY?all():double()):($nobyda.notify("京东签到","","脚本终止, 未获取Cookie ‼️"),$nobyda.done()))}function double(){if(KEY="",1==DualAccount&&(DualAccount++,KEY=Key?DualKey:""),!KEY&&OtherKey){DualAccount++;let e=[];try{e=JSON.parse(OtherKey)}catch(o){e=[],console.log("\n第三及以上账号Cookie读取失败, 请检查Json格式.")}e.length+2>=DualAccount&&(KEY=e[DualAccount-3].cookie)}KEY?all():($nobyda.isJSBox&&$intents.finish(Shortcut),$nobyda.time(),$nobyda.done())}function JingDongBean(e){return merge.JDBean={},new Promise((o=>{if(disable("JDBean"))return o();setTimeout((()=>{const e={url:"https://api.m.jd.com/client.action",headers:{Cookie:KEY},body:"functionId=signBeanIndex&appid=ld"};$nobyda.post(e,(function(e,t,n){try{if(e)throw new Error(e);{const e=JSON.parse(n),o=LogDetails?"response:\n"+n:"";if(3==e.code)console.log("\n京东商城-京豆Cookie失效 "+o),merge.JDBean.notify="京东商城-京豆: 失败, 原因: Cookie失效‼️",merge.JDBean.fail=1;else if(n.match(/跳转至拼图/))merge.JDBean.notify="京东商城-京豆: 失败, 需要拼图验证 ⚠️",merge.JDBean.fail=1;else if(n.match(/\"status\":\"?1\"?/)){if(console.log("\n京东商城-京豆签到成功 "+o),n.match(/dailyAward/))merge.JDBean.notify="京东商城-京豆: 成功, 明细: "+e.data.dailyAward.beanAward.beanCount+"京豆 🐶",merge.JDBean.bean=e.data.dailyAward.beanAward.beanCount;else if(n.match(/continuityAward/))merge.JDBean.notify="京东商城-京豆: 成功, 明细: "+e.data.continuityAward.beanAward.beanCount+"京豆 🐶",merge.JDBean.bean=e.data.continuityAward.beanAward.beanCount;else if(n.match(/新人签到/)){const e=n.match(/beanCount\":\"(\d+)\".+今天/);merge.JDBean.bean=e?e[1]:0,merge.JDBean.notify="京东商城-京豆: 成功, 明细: "+(e?e[1]:"无")+"京豆 🐶"}else merge.JDBean.notify="京东商城-京豆: 成功, 明细: 无京豆 🐶";merge.JDBean.success=1}else merge.JDBean.fail=1,console.log("\n京东商城-京豆签到失败 "+o),n.match(/(已签到|新人签到)/)?merge.JDBean.notify="京东商城-京豆: 失败, 原因: 已签过 ⚠️":n.match(/人数较多|S101/)?merge.JDBean.notify="京东商城-京豆: 失败, 签到人数较多 ⚠️":merge.JDBean.notify="京东商城-京豆: 失败, 原因: 未知 ⚠️"}}catch(e){$nobyda.AnError("京东商城-京豆","JDBean",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JingDongTurn(e){return merge.JDTurn={},merge.JDTurn.notify="",merge.JDTurn.success=0,merge.JDTurn.bean=0,new Promise(((o,t)=>{if(disable("JDTurn"))return t();const n={url:"https://api.m.jd.com/client.action?functionId=wheelSurfIndex&body=%7B%22actId%22%3A%22jgpqtzjhvaoym%22%2C%22appSource%22%3A%22jdhome%22%7D&appid=ld",headers:{Cookie:KEY}};$nobyda.get(n,(async function(e,n,r){try{if(e)throw new Error(e);{const e=JSON.parse(r).data.lotteryCode,t=LogDetails?"response:\n"+r:"";if(e)return console.log("\n京东商城-转盘查询成功 "+t),o(e);merge.JDTurn.notify="京东商城-转盘: 失败, 原因: 查询错误 ⚠️",merge.JDTurn.fail=1,console.log("\n京东商城-转盘查询失败 "+t)}}catch(e){$nobyda.AnError("京东转盘-查询","JDTurn",e,n,r)}finally{t()}})),out&&setTimeout(t,out+e)})).then((o=>JingDongTurnSign(e,o)),(()=>{}))}function JingDongTurnSign(e,o){return new Promise((t=>{setTimeout((()=>{const e={url:`https://api.m.jd.com/client.action?functionId=lotteryDraw&body=%7B%22actId%22%3A%22jgpqtzjhvaoym%22%2C%22appSource%22%3A%22jdhome%22%2C%22lotteryCode%22%3A%22${o}%22%7D&appid=ld`,headers:{Cookie:KEY}};$nobyda.get(e,(async function(e,n,r){try{if(e)throw new Error(e);{const e=JSON.parse(r),t=LogDetails?"response:\n"+r:"",n=!!merge.JDTurn.notify;3==e.code?(console.log("\n京东转盘Cookie失效 "+t),merge.JDTurn.notify="京东商城-转盘: 失败, 原因: Cookie失效‼️",merge.JDTurn.fail=1):r.match(/(\"T216\"|活动结束)/)?(merge.JDTurn.notify="京东商城-转盘: 失败, 原因: 活动结束 ⚠️",merge.JDTurn.fail=1):r.match(/(京豆|\"910582\")/)?(console.log("\n京东商城-转盘签到成功 "+t),merge.JDTurn.bean+=Number(e.data.prizeSendNumber)||0,merge.JDTurn.notify+=`${n?"\n":""}京东商城-转盘: ${n?"多次":"成功"}, 明细: ${e.data.prizeSendNumber||"无"}京豆 🐶`,merge.JDTurn.success+=1,"0"!=e.data.chances&&await JingDongTurnSign(2e3,o)):r.match(/未中奖/)?(merge.JDTurn.notify+=`${n?"\n":""}京东商城-转盘: ${n?"多次":"成功"}, 状态: 未中奖 🐶`,merge.JDTurn.success+=1,"0"!=e.data.chances&&await JingDongTurnSign(2e3,o)):(console.log("\n京东商城-转盘签到失败 "+t),merge.JDTurn.fail=1,r.match(/(T215|次数为0)/)?merge.JDTurn.notify="京东商城-转盘: 失败, 原因: 已转过 ⚠️":r.match(/(T210|密码)/)?merge.JDTurn.notify="京东商城-转盘: 失败, 原因: 无支付密码 ⚠️":merge.JDTurn.notify+=`${n?"\n":""}京东商城-转盘: 失败, 原因: 未知 ⚠️${n?" (多次)":""}`)}}catch(e){$nobyda.AnError("京东商城-转盘","JDTurn",e,n,r)}finally{t()}}))}),e),out&&setTimeout(t,out+e)}))}function JingRongSteel(e){return merge.JRSteel={},new Promise((o=>{if(disable("JRSteel"))return o();setTimeout((()=>{const e={url:"https://ms.jr.jd.com/gw/generic/hy/h5/m/signIn1",headers:{Cookie:KEY},body:"reqData=%7B%22channelSource%22%3A%22JRAPP6.0%22%2C%22riskDeviceParam%22%3A%22%7B%7D%22%7D"};$nobyda.post(e,(function(e,t,n){try{if(e)throw new Error(e);const t=JSON.parse(n),r=LogDetails?"response:\n"+n:"";if(n.match(/\"resBusiCode\":0/)){console.log("\n京东金融-钢镚签到成功 "+r);const e=t.resultData.resBusiData.actualTotalRewardsValue,o=t.resultData.resBusiData.baseReward;merge.JRSteel.steel=e?e>9?"0."+e:"0.0"+e:o||0,merge.JRSteel.notify=`京东金融-钢镚: 成功, 明细: ${merge.JRSteel.steel||"无"}钢镚 💰`,merge.JRSteel.success=1}else console.log("\n京东金融-钢镚签到失败 "+r),merge.JRSteel.fail=1,n.match(/已经领取|\"resBusiCode\":15/)?merge.JRSteel.notify="京东金融-钢镚: 失败, 原因: 已签过 ⚠️":n.match(/未实名/)?merge.JRSteel.notify="京东金融-钢镚: 失败, 账号未实名 ⚠️":n.match(/(\"resultCode\":3|请先登录)/)?merge.JRSteel.notify="京东金融-钢镚: 失败, 原因: Cookie失效‼️":merge.JRSteel.notify="京东金融-钢镚: 失败, 原因: 未知 ⚠️"}catch(e){$nobyda.AnError("京东金融-钢镚","JRSteel",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JingDongShake(e){return merge.JDShake||(merge.JDShake={},merge.JDShake.success=0,merge.JDShake.bean=0,merge.JDShake.notify=""),new Promise((o=>{if(disable("JDShake"))return o();setTimeout((()=>{const t={url:"https://api.m.jd.com/client.action?appid=vip_h5&functionId=vvipclub_shaking",headers:{Cookie:KEY}};$nobyda.get(t,(async function(t,n,r){try{if(t)throw new Error(t);{const o=LogDetails?"response:\n"+r:"",t=JSON.parse(r),n=!!merge.JDShake.notify;r.match(/prize/)?(console.log("\n京东商城-摇一摇签到成功 "+o),merge.JDShake.success+=1,t.data.prizeBean?(merge.JDShake.bean+=t.data.prizeBean.count||0,merge.JDShake.notify+=`${n?"\n":""}京东商城-摇摇: ${n?"多次":"成功"}, 明细: ${merge.JDShake.bean||"无"}京豆 🐶`):t.data.prizeCoupon?merge.JDShake.notify+=`${n?"\n":""}京东商城-摇摇: ${n?"多次, ":""}获得满${t.data.prizeCoupon.quota}减${t.data.prizeCoupon.discount}优惠券→ ${t.data.prizeCoupon.limitStr}`:merge.JDShake.notify+=`${n?"\n":""}京东商城-摇摇: 成功, 明细: 未知 ⚠️${n?" (多次)":""}`,0!=t.data.luckyBox.freeTimes&&await JingDongShake(e)):(console.log("\n京东商城-摇一摇签到失败 "+o),r.match(/true/)?(merge.JDShake.notify+=`${n?"\n":""}京东商城-摇摇: 成功, 明细: 无奖励 🐶${n?" (多次)":""}`,merge.JDShake.success+=1,0!=t.data.luckyBox.freeTimes&&await JingDongShake(e)):(merge.JDShake.fail=1,r.match(/(无免费|8000005|9000005)/)?merge.JDShake.notify="京东商城-摇摇: 失败, 原因: 已摇过 ⚠️":r.match(/(未登录|101)/)?merge.JDShake.notify="京东商城-摇摇: 失败, 原因: Cookie失效‼️":merge.JDShake.notify+=`${n?"\n":""}京东商城-摇摇: 失败, 原因: 未知 ⚠️${n?" (多次)":""}`))}}catch(e){$nobyda.AnError("京东商城-摇摇","JDShake",e,n,r)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JDUserSignPre(e,o,t,n){return merge[o]={},$nobyda.isJSBox?JDUserSignPre2(e,o,t,n):JDUserSignPre1(e,o,t,n)}function JDUserSignPre1(e,o,t,n,r){return new Promise(((a,i)=>{if(disable(o,t,1))return i();const s={url:"https://api.m.jd.com/?client=wh5&functionId=qryH5BabelFloors",headers:{Cookie:KEY},opts:{filter:'try{var od=JSON.parse(body);var params=(od.floatLayerList||[]).filter(o=>o.params&&o.params.match(/enActK/)).map(o=>o.params).pop()||(od.floorList||[]).filter(o=>o.template=="signIn"&&o.signInfos&&o.signInfos.params&&o.signInfos.params.match(/enActK/)).map(o=>o.signInfos&&o.signInfos.params).pop();var tId=(od.floorList||[]).filter(o=>o.boardParams&&o.boardParams.turnTableId).map(o=>o.boardParams.turnTableId).pop();var page=od.paginationFlrs;return JSON.stringify({qxAct:params||null,qxTid:tId||null,qxPage:page||null})}catch(e){return `=> 过滤器发生错误: ${e.message}`}'},body:"body="+encodeURIComponent(`{"activityId":"${n}"${r?`,"paginationParam":"2","paginationFlrs":"${r}"`:""}}`)};$nobyda.post(s,(async function(e,n,s){try{if(e)throw new Error(e);{const e=JSON.parse(s||"{}"),n=e.qxTid||(e.floorList||[]).filter((e=>e.boardParams&&e.boardParams.turnTableId)).map((e=>e.boardParams.turnTableId)).pop(),i=e.qxPage||e.paginationFlrs;if(s.match(/enActK/)){let n=e.qxAct||(e.floatLayerList||[]).filter((e=>e.params&&e.params.match(/enActK/))).map((e=>e.params)).pop();if(!n){let r=(e.floorList||[]).filter((e=>"signIn"==e.template&&e.signInfos&&e.signInfos.params&&e.signInfos.params.match(/enActK/))).map((e=>e.signInfos)).pop();r?"1"==r.signStat?(console.log(`\n${t}重复签到`),merge[o].notify=t+": 失败, 原因: 已签过 ⚠️",merge[o].fail=1):n=r.params:(merge[o].notify=t+": 失败, 活动查找异常 ⚠️",merge[o].fail=1)}if(n)return a({params:n})}else if(n){if("false"!==$nobyda.read("JD_Follow_disable"))return console.log(`\n${t}关注店铺`),a(parseInt(n));merge[o].notify=t+": 失败, 需要关注店铺 ⚠️",merge[o].fail=1}else if(i&&!r){if("false"!==$nobyda.read("JD_Retry_disable"))return console.log(`\n${t}二次查询`),a(i);merge[o].notify=t+": 失败, 请尝试开启增强 ⚠️",merge[o].fail=1}else merge[o].notify=`${t}: 失败, ${s?"不含活动数据":"需要手动执行"} ⚠️`,merge[o].fail=1}i()}catch(e){$nobyda.AnError(t,o,e,n,s),i()}})),out&&setTimeout(i,out+e)})).then((r=>(disable(o,t,2),"object"==typeof r?JDUserSign1(e,o,t,encodeURIComponent(JSON.stringify(r))):"number"==typeof r?JDUserSign2(e,o,t,r):"string"==typeof r?JDUserSignPre1(e,o,t,n,r):void 0)),(()=>disable(o,t,2)))}function JDUserSignPre2(e,o,t,n){return new Promise(((r,a)=>{if(disable(o,t,1))return a();const i={url:`https://pro.m.jd.com/mall/active/${n}/index.html`,headers:{Cookie:KEY}};$nobyda.get(i,(async function(e,n,i){try{if(e)throw new Error(e);{const e=i.match(/\"params\":\"\{\\\"enActK.+?\\\"\}\"/),n=i.match(/\"turnTableId\":\"(\d+)\"/),a=i.match(/\"paginationFlrs\":\"(\[\[.+?\]\])\"/);if(e)return r(e);if(n){if("false"!==$nobyda.read("JD_Follow_disable"))return console.log(`\n${t}关注店铺`),r(parseInt(n[1]));merge[o].notify=t+": 失败, 需要关注店铺 ⚠️",merge[o].fail=1}else if(a){if("false"!==$nobyda.read("JD_Retry_disable"))return console.log(`\n${t}二次查询`),r(a[1]);merge[o].notify=t+": 失败, 请尝试开启增强 ⚠️",merge[o].fail=1}else merge[o].notify=`${t}: 失败, ${i?"不含活动数据":"需要手动执行"} ⚠️`,merge[o].fail=1}a()}catch(e){$nobyda.AnError(t,o,e,n,i),a()}})),out&&setTimeout(a,out+e)})).then((r=>(disable(o,t,2),"object"==typeof r?JDUserSign1(e,o,t,encodeURIComponent(`{${r}}`)):"number"==typeof r?JDUserSign2(e,o,t,r):"string"==typeof r?JDUserSignPre1(e,o,t,n,r):void 0)),(()=>disable(o,t,2)))}function JDUserSign1(e,o,t,n){return new Promise((r=>{setTimeout((()=>{const e={url:"https://api.m.jd.com/client.action?functionId=userSign",headers:{Cookie:KEY},body:`body=${n}&client=wh5`};$nobyda.post(e,(function(e,n,a){try{if(e)throw new Error(e);{const e=LogDetails?"response:\n"+a:"";if(a.match(/签到成功/))console.log(`\n${t}签到成功(1)${e}`),a.match(/\"text\":\"\d+京豆\"/)&&(merge[o].bean=a.match(/\"text\":\"(\d+)京豆\"/)[1]),merge[o].notify=`${t}: 成功, 明细: ${merge[o].bean||"无"}京豆 🐶`,merge[o].success=1;else{if(console.log(`\n${t}签到失败(1)${e}`),a.match(/(已签到|已领取)/))merge[o].notify=t+": 失败, 原因: 已签过 ⚠️";else if(a.match(/(不存在|已结束|未开始)/))merge[o].notify=t+": 失败, 原因: 活动已结束 ⚠️";else if(a.match(/\"code\":\"?3\"?/))merge[o].notify=t+": 失败, 原因: Cookie失效‼️";else{const e=a.match(/\"(errorMessage|subCodeMsg)\":\"(.+?)\"/);merge[o].notify=`${t}: 失败, ${e?e[2]:"原因: 未知"} ⚠️`}merge[o].fail=1}}}catch(e){$nobyda.AnError(t,o,e,n,a)}finally{r()}}))}),e),out&&setTimeout(r,out+e)}))}async function JDUserSign2(e,o,t,n){return await new Promise((o=>{$nobyda.get({url:`https://jdjoy.jd.com/api/turncard/channel/detail?turnTableId=${n}&invokeKey=NRp8OPxZMFXmGkaE`,headers:{Cookie:KEY}},(function(e,t,n){o()})),out&&setTimeout(o,out+e)})),new Promise((r=>{setTimeout((()=>{const e={url:"https://jdjoy.jd.com/api/turncard/channel/sign?invokeKey=NRp8OPxZMFXmGkaE",headers:{Cookie:KEY},body:"turnTableId="+n};$nobyda.post(e,(function(e,n,a){try{if(e)throw new Error(e);{const e=LogDetails?"response:\n"+a:"";if(a.match(/\"success\":true/))console.log(`\n${t}签到成功(2)${e}`),a.match(/\"jdBeanQuantity\":\d+/)&&(merge[o].bean=a.match(/\"jdBeanQuantity\":(\d+)/)[1]),merge[o].notify=`${t}: 成功, 明细: ${merge[o].bean||"无"}京豆 🐶`,merge[o].success=1;else{const n=/请进行验证/.test(a);if(a.match(/(已经签到|已经领取)/))merge[o].notify=t+": 失败, 原因: 已签过 ⚠️";else if(a.match(/(不存在|已结束|未开始)/))merge[o].notify=t+": 失败, 原因: 活动已结束 ⚠️";else if(a.match(/(没有登录|B0001)/))merge[o].notify=t+": 失败, 原因: Cookie失效‼️";else if(!n){const e=a.match(/\"(errorMessage|subCodeMsg)\":\"(.+?)\"/);merge[o].notify=`${t}: 失败, ${e?e[2]:"原因: 未知"} ⚠️`}n||(merge[o].fail=1),console.log(`\n${t}签到失败(2)${n?"\n需要拼图验证, 跳过通知记录 ⚠️":""}${e}`)}}}catch(e){$nobyda.AnError(t,o,e,n,a)}finally{r()}}))}),200+e),out&&setTimeout(r,out+e+200)}))}function JDFlashSale(e){return merge.JDFSale={},new Promise((o=>{if(disable("JDFSale"))return o();setTimeout((()=>{const t={url:"https://api.m.jd.com/client.action?functionId=partitionJdSgin",headers:{Cookie:KEY},body:"body=%7B%22version%22%3A%22v2%22%7D&client=apple&clientVersion=9.0.8&openudid=1fce88cd05c42fe2b054e846f11bdf33f016d676&sign=6768e2cf625427615dd89649dd367d41&st=1597248593305&sv=121"};$nobyda.post(t,(async function(t,n,r){try{if(t)throw new Error(t);{const o=LogDetails?"response:\n"+r:"",t=JSON.parse(r);if(t.result&&0==t.result.code)console.log("\n京东商城-闪购签到成功 "+o),merge.JDFSale.bean=t.result.jdBeanNum||0,merge.JDFSale.notify="京东商城-闪购: 成功, 明细: "+(merge.JDFSale.bean||"无")+"京豆 🐶",merge.JDFSale.success=1;else{if(console.log("\n京东商城-闪购签到失败 "+o),r.match(/(已签到|已领取|\"2005\")/))merge.JDFSale.notify="京东商城-闪购: 失败, 原因: 已签过 ⚠️";else{if(r.match(/不存在|已结束|\"2008\"|\"3001\"/))return void await FlashSaleDivide(e);if(r.match(/(\"code\":\"3\"|\"1003\")/))merge.JDFSale.notify="京东商城-闪购: 失败, 原因: Cookie失效‼️";else{const e=r.match(/\"msg\":\"([\u4e00-\u9fa5].+?)\"/);merge.JDFSale.notify=`京东商城-闪购: 失败, ${e?e[1]:"原因: 未知"} ⚠️`}}merge.JDFSale.fail=1}}}catch(e){$nobyda.AnError("京东商城-闪购","JDFSale",e,n,r)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function FlashSaleDivide(e){return new Promise((o=>{setTimeout((()=>{const e={url:"https://api.m.jd.com/client.action?functionId=partitionJdShare",headers:{Cookie:KEY},body:"body=%7B%22version%22%3A%22v2%22%7D&client=apple&clientVersion=9.0.8&openudid=1fce88cd05c42fe2b054e846f11bdf33f016d676&sign=49baa3b3899b02bbf06cdf41fe191986&st=1597682588351&sv=111"};$nobyda.post(e,(function(e,t,n){try{if(e)throw new Error(e);{const e=LogDetails?"response:\n"+n:"",o=JSON.parse(n);if(0==o.result.code)merge.JDFSale.success=1,merge.JDFSale.bean=o.result.jdBeanNum||0,merge.JDFSale.notify="京东闪购-瓜分: 成功, 明细: "+(merge.JDFSale.bean||"无")+"京豆 🐶",console.log("\n京东闪购-瓜分签到成功 "+e);else if(merge.JDFSale.fail=1,console.log("\n京东闪购-瓜分签到失败 "+e),n.match(/已参与|已领取|\"2006\"/))merge.JDFSale.notify="京东闪购-瓜分: 失败, 原因: 已瓜分 ⚠️";else if(n.match(/不存在|已结束|未开始|\"2008\"|\"2012\"/))merge.JDFSale.notify="京东闪购-瓜分: 失败, 原因: 活动已结束 ⚠️";else if(n.match(/\"code\":\"1003\"|未获取/))merge.JDFSale.notify="京东闪购-瓜分: 失败, 原因: Cookie失效‼️";else{const e=n.match(/\"msg\":\"([\u4e00-\u9fa5].+?)\"/);merge.JDFSale.notify=`京东闪购-瓜分: 失败, ${e?e[1]:"原因: 未知"} ⚠️`}}}catch(e){$nobyda.AnError("京东闪购-瓜分","JDFSale",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JingDongCash(e){return merge.JDCash={},new Promise((o=>{if(disable("JDCash"))return o();setTimeout((()=>{const e={url:"https://api.m.jd.com/client.action?functionId=ccSignInNew",headers:{Cookie:KEY},body:"body=%7B%22pageClickKey%22%3A%22CouponCenter%22%2C%22eid%22%3A%22O5X6JYMZTXIEX4VBCBWEM5PTIZV6HXH7M3AI75EABM5GBZYVQKRGQJ5A2PPO5PSELSRMI72SYF4KTCB4NIU6AZQ3O6C3J7ZVEP3RVDFEBKVN2RER2GTQ%22%2C%22shshshfpb%22%3A%22v1%5C%2FzMYRjEWKgYe%2BUiNwEvaVlrHBQGVwqLx4CsS9PH1s0s0Vs9AWk%2B7vr9KSHh3BQd5NTukznDTZnd75xHzonHnw%3D%3D%22%2C%22childActivityUrl%22%3A%22openapp.jdmobile%253a%252f%252fvirtual%253fparams%253d%257b%255c%2522category%255c%2522%253a%255c%2522jump%255c%2522%252c%255c%2522des%255c%2522%253a%255c%2522couponCenter%255c%2522%257d%22%2C%22monitorSource%22%3A%22cc_sign_ios_index_config%22%7D&client=apple&clientVersion=8.5.0&d_brand=apple&d_model=iPhone8%2C2&openudid=1fce88cd05c42fe2b054e846f11bdf33f016d676&scope=11&screen=1242%2A2208&sign=1cce8f76d53fc6093b45a466e93044da&st=1581084035269&sv=102"};$nobyda.post(e,(function(e,t,n){try{if(e)throw new Error(e);{const e=LogDetails?"response:\n"+n:"",o=JSON.parse(n);if("0"==o.busiCode)console.log("\n京东现金-红包签到成功 "+e),merge.JDCash.success=1,merge.JDCash.Cash=o.result.signResult.signData.amount||0,merge.JDCash.notify=`京东现金-红包: 成功, 明细: ${merge.JDCash.Cash||"无"}红包 🧧`;else if(console.log("\n京东现金-红包签到失败 "+e),merge.JDCash.fail=1,n.match(/(\"busiCode\":\"1002\"|完成签到)/))merge.JDCash.notify="京东现金-红包: 失败, 原因: 已签过 ⚠️";else if(n.match(/(不存在|已结束)/))merge.JDCash.notify="京东现金-红包: 失败, 原因: 活动已结束 ⚠️";else if(n.match(/(\"busiCode\":\"3\"|未登录)/))merge.JDCash.notify="京东现金-红包: 失败, 原因: Cookie失效‼️";else{const e=n.split(/\"msg\":\"([\u4e00-\u9fa5].+?)\"/)[1];merge.JDCash.notify=`京东现金-红包: 失败, ${e||"原因: 未知"} ⚠️`}}}catch(e){$nobyda.AnError("京东现金-红包","JDCash",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JDMagicCube(e,o){return merge.JDCube={},new Promise(((t,n)=>{if(disable("JDCube"))return n();const r={url:"https://api.m.jd.com/client.action?functionId=getNewsInteractionInfo&appid=smfe"+(o?"&body="+encodeURIComponent(`{"sign":${o}}`):""),headers:{Cookie:KEY}};$nobyda.get(r,(async(r,a,i)=>{try{if(r)throw new Error(r);const a=LogDetails?"response:\n"+i:"";console.log(`\n京东魔方-尝试查询活动(${o}) ${a}`),i.match(/\"interactionId\":\d+/)?t({id:i.match(/\"interactionId\":(\d+)/)[1],sign:o||null}):i.match(/配置异常/)&&o?(await JDMagicCube(e,2==o?1:null),n()):t(null)}catch(e){$nobyda.AnError("京东魔方-查询","JDCube",e,a,i),n()}})),out&&setTimeout(n,out+e)})).then((o=>JDMagicCubeSign(e,o)),(()=>{}))}function JDMagicCubeSign(e,o){return new Promise((t=>{setTimeout((()=>{const e={url:"https://api.m.jd.com/client.action?functionId=getNewsInteractionLotteryInfo&appid=smfe"+(o?"&body="+encodeURIComponent(`{${o.sign?`"sign":${o.sign},`:""}"interactionId":${o.id}}`):""),headers:{Cookie:KEY}};$nobyda.get(e,(function(e,o,n){try{if(e)throw new Error(e);{const e=LogDetails?"response:\n"+n:"",o=JSON.parse(n);n.match(/(\"name\":)/)?(console.log("\n京东商城-魔方签到成功 "+e),merge.JDCube.success=1,n.match(/(\"name\":\"京豆\")/)?(merge.JDCube.bean=o.result.lotteryInfo.quantity||0,merge.JDCube.notify=`京东商城-魔方: 成功, 明细: ${merge.JDCube.bean||"无"}京豆 🐶`):merge.JDCube.notify=`京东商城-魔方: 成功, 明细: ${o.result.lotteryInfo.name||"未知"} 🎉`):(console.log("\n京东商城-魔方签到失败 "+e),merge.JDCube.fail=1,n.match(/(一闪而过|已签到|已领取)/)?merge.JDCube.notify="京东商城-魔方: 失败, 原因: 无机会 ⚠️":n.match(/(不存在|已结束)/)?merge.JDCube.notify="京东商城-魔方: 失败, 原因: 活动已结束 ⚠️":n.match(/(\"code\":3)/)?merge.JDCube.notify="京东商城-魔方: 失败, 原因: Cookie失效‼️":merge.JDCube.notify="京东商城-魔方: 失败, 原因: 未知 ⚠️")}}catch(e){$nobyda.AnError("京东商城-魔方","JDCube",e,o,n)}finally{t()}}))}),e),out&&setTimeout(t,out+e)}))}function JingDongSubsidy(e){return merge.subsidy={},new Promise((o=>{if(disable("subsidy"))return o();setTimeout((()=>{const e={url:"https://ms.jr.jd.com/gw/generic/uc/h5/m/signIn7",headers:{Referer:"https://active.jd.com/forever/cashback/index",Cookie:KEY}};$nobyda.get(e,(function(e,t,n){try{if(e)throw new Error(e);{const e=LogDetails?"response:\n"+n:"",o=JSON.parse(n);if(0==o.resultCode&&o.resultData.data&&o.resultData.data.thisAmount)console.log("\n京东商城-金贴签到成功 "+e),merge.subsidy.subsidy=o.resultData.data.thisAmountStr,merge.subsidy.notify=`京东商城-金贴: 成功, 明细: ${merge.subsidy.subsidy||"无"}金贴 💰`,merge.subsidy.success=1;else if(console.log("\n京东商城-金贴签到失败 "+e),merge.subsidy.fail=1,n.match(/已存在|"thisAmount":0/))merge.subsidy.notify="京东商城-金贴: 失败, 原因: 无金贴 ⚠️";else if(n.match(/请先登录/))merge.subsidy.notify="京东商城-金贴: 失败, 原因: Cookie失效‼️";else{const e=n.split(/\"msg\":\"([\u4e00-\u9fa5].+?)\"/)[1];merge.subsidy.notify=`京东商城-金贴: 失败, ${e||"原因: 未知"} ⚠️`}}}catch(e){$nobyda.AnError("京东商城-金贴","subsidy",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JingRongDoll(e,o,t,n,r,a,i,s){return merge[o]={},new Promise((l=>{if(disable(o))return l();setTimeout((()=>{const c={url:"https://nu.jr.jd.com/gw/generic/jrm/h5/m/process",headers:{Cookie:KEY},body:"reqData="+encodeURIComponent(`{"actCode":"${n}","type":${r||"3"}${"F68B2C3E71"==n?`,"frontParam":{"belong":"${s}"}`:"1DF13833F7"==n?',"frontParam":{"channel":"JR","belong":4}':""}}`)};$nobyda.post(c,(async function(r,c,d){try{if(r)throw new Error(r);{var u=JSON.parse(d);const r=LogDetails?"response:\n"+d:"";if(0==u.resultCode)if(null!=u.resultData.data.businessData)if(console.log(`\n${t}查询成功 ${r}`),2==u.resultData.data.businessData.pickStatus)if(d.match(/\"rewardPrice\":\"\d.*?\"/)){const r=d.match(/\"rewardPrice\":\"(\d.*?)\"/)[1],a=!!d.match(/\"rewardName\":\"金贴奖励\"/);await JingRongDoll(e,o,t,n,"4",r,a)}else merge[o].success=1,merge[o].notify=t+": 成功, 明细: 无奖励 🐶";else if("F68B2C3E71"==n||"1DF13833F7"==n)if(d.match(/"businessCode":"30\dss?q"/)){const e=u.resultData.data.businessMsg,n=u.resultData.data.businessData.businessMsg,r=d.match(/已领取|300ss?q/)?"已签过":""+(n||e||u.resultMsg||"未知");merge[o].notify=`${t}: 失败, 原因: ${r} ⚠️`,merge[o].fail=1}else{merge[o].success=1;const e=d.match(/\"count\":\"?(\d.*?)\"?,/);"F68B2C3E71"==n&&"xianjin"==s?(merge[o].Money=e?e[1]>9?"0."+e[1]:"0.0"+e[1]:0,merge[o].notify=`${t}: 成功, 明细: ${merge[o].Money||"无"}现金 💰`):"F68B2C3E71"==n&&"jingdou"==s?(merge[o].bean=e?e[1]:0,merge[o].notify=`${t}: 成功, 明细: ${merge[o].bean||"无"}京豆 🐶`):"1DF13833F7"==n&&(merge[o].subsidy=e?e[1]:0,merge[o].notify=`${t}: 成功, 明细: ${merge[o].subsidy||"无"}金贴 💰`)}else merge[o].notify=t+": 失败, 原因: 已签过 ⚠️",merge[o].fail=1;else 200==u.resultData.data.businessCode?(console.log(`\n${t}签到成功 ${r}`),i?merge[o].subsidy=a||0:merge[o].bean=a?a.match(/\d+/)[0]:0,merge[o].success=1,merge[o].notify=`${t}: 成功, 明细: ${(i?a:merge[o].bean)||"无"}${i?"金贴 💰":"京豆 🐶"}`):(console.log(`\n${t}领取异常 ${r}`),a&&console.log(`\n${t} 请尝试手动领取, 预计可得${a}${i?"金贴":"京豆"}: \nhttps://uf1.jr.jd.com/up/redEnvelopes/index.html?actCode=${n}\n`),merge[o].fail=1,merge[o].notify=t+": 失败, 原因: 领取异常 ⚠️");else{console.log(`\n${t}签到失败 ${r}`);const e="string"==typeof u.resultData?u.resultData:"";merge[o].notify=`${t}: 失败, ${3==u.resultCode?"原因: Cookie失效‼️":""+(e||"原因: 未知 ⚠️")}`,merge[o].fail=1}}}catch(e){$nobyda.AnError(t,o,e,c,d)}finally{l()}}))}),e),out&&setTimeout(l,out+e)}))}function JingDongGetCash(e){return merge.JDGetCash={},new Promise((o=>{if(disable("JDGetCash"))return o();setTimeout((()=>{const e={url:"https://api.m.jd.com/client.action?functionId=cash_sign&body=%7B%22remind%22%3A0%2C%22inviteCode%22%3A%22%22%2C%22type%22%3A0%2C%22breakReward%22%3A0%7D&client=apple&clientVersion=9.0.8&openudid=1fce88cd05c42fe2b054e846f11bdf33f016d676&sign=7e2f8bcec13978a691567257af4fdce9&st=1596954745073&sv=111",headers:{Cookie:KEY}};$nobyda.get(e,(function(e,t,n){try{if(e)throw new Error(e);{const e=JSON.parse(n),o=LogDetails?"response:\n"+n:"";e.data.success&&e.data.result?(console.log("\n京东商城-现金签到成功 "+o),merge.JDGetCash.success=1,merge.JDGetCash.Money=e.data.result.signCash||0,merge.JDGetCash.notify=`京东商城-现金: 成功, 明细: ${e.data.result.signCash||"无"}现金 💰`):(console.log("\n京东商城-现金签到失败 "+o),merge.JDGetCash.fail=1,n.match(/\"bizCode\":201|已经签过/)?merge.JDGetCash.notify="京东商城-现金: 失败, 原因: 已签过 ⚠️":n.match(/\"code\":300|退出登录/)?merge.JDGetCash.notify="京东商城-现金: 失败, 原因: Cookie失效‼️":merge.JDGetCash.notify="京东商城-现金: 失败, 原因: 未知 ⚠️")}}catch(e){$nobyda.AnError("京东商城-现金","JDGetCash",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JingDongStore(e){return merge.JDGStore={},new Promise((o=>{if(disable("JDGStore"))return o();setTimeout((()=>{$nobyda.get({url:"https://api.m.jd.com/api?appid=jdsupermarket&functionId=smtg_sign&clientVersion=8.0.0&client=m&body=%7B%7D",headers:{Cookie:KEY,Origin:"https://jdsupermarket.jd.com"}},((e,t,n)=>{try{if(e)throw new Error(e);const t=JSON.parse(n),r=LogDetails?"response:\n"+n:"";if(t.data&&!0===t.data.success&&0===t.data.bizCode)console.log("\n京东商城-超市签到成功 "+r),merge.JDGStore.success=1,merge.JDGStore.bean=t.data.result.jdBeanCount||0,merge.JDGStore.notify=`京东商城-超市: 成功, 明细: ${merge.JDGStore.bean||"无"}京豆 🐶`;else{t.data||(t.data={}),console.log("\n京东商城-超市签到失败 "+r);const e=811==t.data.bizCode?"已签过":300==t.data.bizCode?"Cookie失效":""+(t.data.bizMsg||"未知");merge.JDGStore.notify=`京东商城-超市: 失败, 原因: ${e}${300==t.data.bizCode?"‼️":" ⚠️"}`,merge.JDGStore.fail=1}}catch(e){$nobyda.AnError("京东商城-超市","JDGStore",e,t,n)}finally{o()}}))}),e),out&&setTimeout(o,out+e)}))}function JDSecKilling(e){return merge.JDSecKill={},new Promise(((o,t)=>{if(disable("JDSecKill"))return t();setTimeout((()=>{$nobyda.post({url:"https://api.m.jd.com/client.action",headers:{Cookie:KEY,Origin:"https://h5.m.jd.com"},body:"functionId=homePageV2&appid=SecKill2020"},((e,n,r)=>{try{if(e)throw new Error(e);const n=LogDetails?"response:\n"+r:"",a=JSON.parse(r);if(203==a.code||3==a.code||101==a.code)merge.JDSecKill.notify="京东秒杀-红包: 失败, 原因: Cookie失效‼️";else{if(a.result&&a.result.projectId&&a.result.taskId)return console.log("\n京东秒杀-红包查询成功 "+n),o({projectId:a.result.projectId,taskId:a.result.taskId});merge.JDSecKill.notify="京东秒杀-红包: 失败, 暂无有效活动 ⚠️"}merge.JDSecKill.fail=1,console.log("\n京东秒杀-红包查询失败 "+n),t()}catch(e){$nobyda.AnError("京东秒杀-查询","JDSecKill",e,n,r),t()}}))}),e),out&&setTimeout(o,out+e)})).then((async e=>{await new Promise((o=>{$nobyda.post({url:"https://api.m.jd.com/client.action",headers:{Cookie:KEY,Origin:"https://h5.m.jd.com"},body:`functionId=doInteractiveAssignment&body=%7B%22encryptProjectId%22%3A%22${e.projectId}%22%2C%22encryptAssignmentId%22%3A%22${e.taskId}%22%2C%22completionFlag%22%3Atrue%7D&client=wh5&appid=SecKill2020`},((e,t,n)=>{try{if(e)throw new Error(e);const t=LogDetails?"response:\n"+n:"",r=JSON.parse(n);if("success"==r.msg&&0==r.subCode){console.log("\n京东秒杀-红包签到成功 "+t);const e=n.match(/"discount":(\d.*?),/);merge.JDSecKill.success=1,merge.JDSecKill.Cash=e?e[1]:0,merge.JDSecKill.notify=`京东秒杀-红包: 成功, 明细: ${merge.JDSecKill.Cash||"无"}红包 🧧`}else console.log("\n京东秒杀-红包签到失败 "+t),merge.JDSecKill.fail=1,merge.JDSecKill.notify=`京东秒杀-红包: 失败, ${103==r.subCode?"原因: 已领取":r.msg?r.msg:"原因: 未知"} ⚠️`}catch(e){$nobyda.AnError("京东秒杀-领取","JDSecKill",e,t,n)}finally{o()}}))}))}),(()=>{}))}function JingDongBuyCar(e,o){return merge.JDBuyCar={},new Promise(((t,n)=>{if(disable("JDBuyCar"))return n();setTimeout((()=>{$nobyda.get({url:"https://cgame-stadium.jd.com/api/v1/first/login",headers:{Cookie:KEY,ActivityId:o}},((e,o,r)=>{try{if(e)throw new Error(e);const o=LogDetails?"response:\n"+r:"";console.log("\n京东汽车-检查签到状态 "+o);const a=JSON.parse(r);if(a.status&&a.data&&a.data.firstLoginStatus)t();else{const e=a.status&&a.data&&!1===a.data.firstLoginStatus?"原因: 已签过":a.error&&2e3==a.error.code?"原因: Cookie失效":a.error&&a.error.msg?a.error.msg:"原因: 未知";merge.JDBuyCar.notify=`京东商城-汽车: 失败, ${e}${a.error&&2e3==a.error.code?"‼️":" ⚠️"}`,merge.JDBuyCar.fail=1,n()}}catch(e){$nobyda.AnError("京东汽车-状态","JDBuyCar",e,o,r),n()}}))}),e),out&&setTimeout(t,out+e)})).then((async()=>{await new Promise((e=>{$nobyda.post({url:"https://cgame-stadium.jd.com/api/v1/sign",headers:{Cookie:KEY,ActivityId:o}},((o,t,n)=>{try{if(o)throw new Error(o);const t=LogDetails?"response:\n"+n:"",r=JSON.parse(n);!0===r.status?(console.log("\n京东商城-汽车签到成功 "+t),merge.JDBuyCar.success=1,merge.JDBuyCar.bean=r.data&&r.data.beanNum?r.data.beanNum:0,merge.JDBuyCar.notify=`京东商城-汽车: 成功, 明细: ${merge.JDBuyCar.bean||"无"}京豆 🐶`):(console.log("\n京东商城-汽车签到失败 "+t),merge.JDBuyCar.fail=1,merge.JDBuyCar.notify=`京东商城-汽车: 失败, ${r.error&&r.error.msg?r.error.msg:"原因: 未知"} ⚠️`)}catch(e){$nobyda.AnError("京东汽车-签到","JDBuyCar",e,t,n)}finally{e()}}))}))}),(()=>{}))}function TotalSteel(){return merge.TotalSteel={},new Promise((e=>{if(disable("TSteel"))return e();$nobyda.get({url:"https://coin.jd.com/m/gb/getBaseInfo.html",headers:{Cookie:KEY}},((o,t,n)=>{try{if(o)throw new Error(o);const t=LogDetails?"response:\n"+n:"";if(n.match(/(\"gbBalance\":\d+)/)){console.log("\n京东-总钢镚查询成功 "+t);const e=JSON.parse(n);merge.TotalSteel.TSteel=e.gbBalance}else console.log("\n京东-总钢镚查询失败 "+t)}catch(e){$nobyda.AnError("账户钢镚-查询","TotalSteel",e,t,n)}finally{e()}})),out&&setTimeout(e,out)}))}function TotalBean(){return merge.TotalBean={},new Promise((e=>{if(disable("Qbear"))return e();$nobyda.get({url:"https://me-api.jd.com/user_new/info/GetJDUserInfoUnion",headers:{Cookie:KEY}},((o,t,n)=>{try{if(o)throw new Error(o);const t=LogDetails?"response:\n"+n:"",r=JSON.parse(n);"success"==r.msg&&0==r.retcode?(merge.TotalBean.nickname=r.data.userInfo.baseInfo.nickname||"",merge.TotalBean.Qbear=r.data.assetInfo.beanNum||0,$nobyda.headUrl=r.data.userInfo.baseInfo.headImageUrl||"",console.log("\n京东-总京豆查询成功 "+t)):(merge.TotalBean.nickname=1001==r.retcode?"Cookie失效 ‼️":"",console.log("\n京东-总京豆查询失败 "+t))}catch(e){$nobyda.AnError("账户京豆-查询","TotalBean",e,t,n)}finally{e()}})),out&&setTimeout(e,out)}))}function TotalCash(){return merge.TotalCash={},new Promise((e=>{if(disable("TCash"))return e();$nobyda.post({url:"https://api.m.jd.com/client.action?functionId=myhongbao_balance",headers:{Cookie:KEY},body:"body=%7B%22fp%22%3A%22-1%22%2C%22appToken%22%3A%22apphongbao_token%22%2C%22childActivityUrl%22%3A%22-1%22%2C%22country%22%3A%22cn%22%2C%22openId%22%3A%22-1%22%2C%22childActivityId%22%3A%22-1%22%2C%22applicantErp%22%3A%22-1%22%2C%22platformId%22%3A%22appHongBao%22%2C%22isRvc%22%3A%22-1%22%2C%22orgType%22%3A%222%22%2C%22activityType%22%3A%221%22%2C%22shshshfpb%22%3A%22-1%22%2C%22platformToken%22%3A%22apphongbao_token%22%2C%22organization%22%3A%22JD%22%2C%22pageClickKey%22%3A%22-1%22%2C%22platform%22%3A%221%22%2C%22eid%22%3A%22-1%22%2C%22appId%22%3A%22appHongBao%22%2C%22childActiveName%22%3A%22-1%22%2C%22shshshfp%22%3A%22-1%22%2C%22jda%22%3A%22-1%22%2C%22extend%22%3A%22-1%22%2C%22shshshfpa%22%3A%22-1%22%2C%22activityArea%22%3A%22-1%22%2C%22childActivityTime%22%3A%22-1%22%7D&client=apple&clientVersion=8.5.0&d_brand=apple&networklibtype=JDNetworkBaseAF&openudid=1fce88cd05c42fe2b054e846f11bdf33f016d676&sign=fdc04c3ab0ee9148f947d24fb087b55d&st=1581245397648&sv=120"},((o,t,n)=>{try{if(o)throw new Error(o);const t=LogDetails?"response:\n"+n:"";if(n.match(/(\"totalBalance\":\d+)/)){console.log("\n京东-总红包查询成功 "+t);const e=JSON.parse(n);merge.TotalCash.TCash=e.totalBalance}else console.log("\n京东-总红包查询失败 "+t)}catch(e){$nobyda.AnError("账户红包-查询","TotalCash",e,t,n)}finally{e()}})),out&&setTimeout(e,out)}))}function TotalSubsidy(){return merge.TotalSubsidy={},new Promise((e=>{if(disable("TotalSubsidy"))return e();$nobyda.get({url:"https://ms.jr.jd.com/gw/generic/uc/h5/m/mySubsidyBalance",headers:{Cookie:KEY,Referer:"https://active.jd.com/forever/cashback/index?channellv=wojingqb"}},((o,t,n)=>{try{if(o)throw new Error(o);const t=JSON.parse(n),r=LogDetails?"response:\n"+n:"";0==t.resultCode&&t.resultData&&t.resultData.data?(console.log("\n京东-总金贴查询成功 "+r),merge.TotalSubsidy.TSubsidy=t.resultData.data.balance||0):console.log("\n京东-总金贴查询失败 "+r)}catch(e){$nobyda.AnError("账户金贴-查询","TotalSubsidy",e,t,n)}finally{e()}})),out&&setTimeout(e,out)}))}function TotalMoney(){return merge.TotalMoney={},new Promise((e=>{if(disable("TotalMoney"))return e();$nobyda.get({url:"https://api.m.jd.com/client.action?functionId=cash_exchangePage&body=%7B%7D&build=167398&client=apple&clientVersion=9.1.9&openudid=1fce88cd05c42fe2b054e846f11bdf33f016d676&sign=762a8e894dea8cbfd91cce4dd5714bc5&st=1602179446935&sv=102",headers:{Cookie:KEY}},((o,t,n)=>{try{if(o)throw new Error(o);const t=JSON.parse(n),r=LogDetails?"response:\n"+n:"";0==t.code&&t.data&&0==t.data.bizCode&&t.data.result?(console.log("\n京东-总现金查询成功 "+r),merge.TotalMoney.TMoney=t.data.result.totalMoney||0):console.log("\n京东-总现金查询失败 "+r)}catch(e){$nobyda.AnError("账户现金-查询","TotalMoney",e,t,n)}finally{e()}})),out&&setTimeout(e,out)}))}function disable(e,o,t){const n=$nobyda.read("JD_DailyBonusDisables"),r=$nobyda.read("JD_Crash_"+e);if(r&&1==t&&boxdis){$nobyda.write("","JD_Crash_"+e);if(n){if(-1==n.indexOf(e)){$nobyda.write(`${n},${e}`,"JD_DailyBonusDisables");console.log(`\n${o}-触发自动禁用 ‼️`),merge[e].notify=o+": 崩溃, 触发自动禁用 ‼️",merge[e].error=1,$nobyda.disable=1}}else{$nobyda.write(e,"JD_DailyBonusDisables");console.log(`\n${o}-触发自动禁用 ‼️`),merge[e].notify=o+": 崩溃, 触发自动禁用 ‼️",merge[e].error=1,$nobyda.disable=1}return!0}if(1==t&&boxdis)$nobyda.write(o,"JD_Crash_"+e);else if(2==t&&r)$nobyda.write("","JD_Crash_"+e);return!(!n||-1==n.indexOf(e))}function Wait(e,o){if(!e||"0"===e)return 0;if("string"==typeof e){if(-1==(e=e.replace(/"|＂|'|＇/g,"")).indexOf("-"))return parseInt(e)||0;const t=e.split("-").map(Number),n=parseInt(Math.random()*(t[1]-t[0]+1)+t[0],10);return o&&console.log(`\n初始化随机延迟: 最小${t[0]/1e3}秒, 最大${t[1]/1e3}秒`),o?e:n}return"number"==typeof e&&e>0?e:0}function GetCookie(){try{if("OPTIONS"!=$request.method&&$request.headers&&"http://www.apple.com/"!==$request.url){let e={},o=($request.headers.Cookie||$request.headers.cookie||"").replace(/ /g,"").split(";").filter((e=>/^(pt_key|pt_pin)=.+/.test(e))).sort();if(2==o.length&&(e.cookie=o.join(";")+";",e.userName=decodeURIComponent(e.cookie.match(/pt_pin=(.+?);/)[1])),!e.cookie)return void $nobyda.notify("写入京东Cookie失败","","请查看脚本内说明, 登录网页获取 ‼️");{const o=[$nobyda.read("CookieJD"),$nobyda.read("CookieJD2")],t=$nobyda.read("CookiesJD");let n=[];try{n=t&&JSON.parse(t)||[]}catch(e){console.log("写入京东Cookie时转换京东扩展账号数据CookiesJD异常，扩展账号信息：\n"+t),n=[]}n.forEach((e=>o.push(e.cookie)));let[r,a]=chooseSeatNo(e.cookie,o,/pt_pin=(.+?);/);if(r)if(r>0){let o="";a<2?o=$nobyda.write(e.cookie,"CookieJD"+(a?a+1:"")):(n.length<=a-2?n.push(e):n[a-2]=e,o=$nobyda.write(JSON.stringify(n,null,2),"CookiesJD")),$nobyda.notify("用户名: "+e.userName,"",`${2==r?"更新":"写入"}京东 [账号${a+1}] Cookie${o?"成功 🎉":"失败 ‼️"}`)}else console.log(`\n用户名: ${e.userName}\n与历史京东 [账号${a+1}] Cookie相同, 跳过写入 ⚠️`)}}else"http://www.apple.com/"===$request.url?$nobyda.notify("京东签到","","类型错误, 手动运行请选择上下文环境为Cron ⚠️"):$nobyda.notify("京东签到","写入Cookie失败","请检查匹配URL或配置内脚本类型 ⚠️")}catch(e){$nobyda.write("","CookieJD"),$nobyda.write("","CookieJD2"),$nobyda.write("","CookiesJD"),$nobyda.notify("写入京东Cookie失败","","已尝试清空历史Cookie, 请重试 ⚠️"),console.log(`\n写入京东Cookie出现错误 ‼️\n${JSON.stringify(e)}\n\n${e}\n\n${JSON.stringify($request.headers)}\n`)}finally{$nobyda.done()}}function chooseSeatNo(e,o,t){let[n,r]=[1,o.length];try{let a=((e||"").match(t)||["",""])[1];for(let i=0,s=o.length;i<s;i++){let l=((o[i]||"").match(t)||["",""])[1];if(l){if(l==a){r=i,n=e==o[i]?-1:2;break}}else r==s&&(r=i,n=1)}}catch(e){n=0,console.log(`\n查询账号存储位置异常 ‼️\n${JSON.stringify(e)}\n\n${e}\n`)}return[n,r]}function nobyda(){const e=Date.now(),o="undefined"!=typeof $request,t="undefined"!=typeof $httpClient,n="undefined"!=typeof $task,r="undefined"!=typeof $loon,a="undefined"!=typeof $app&&"undefined"!=typeof $http,i="function"==typeof require&&!a,s="CookieSet.json",l=(()=>{if(i){return{request:require("request"),fs:require("fs")}}return null})(),c=e=>(e&&(e.status?e.statusCode=e.status:e.statusCode&&(e.status=e.statusCode)),e),d=(e,o,t,n,r)=>("undefined"!=typeof merge&&o&&(merge[o].notify?merge[o].notify+=`\n${e}: 异常, 已输出日志 ‼️ (2)`:merge[o].notify=e+": 异常, 已输出日志 ‼️",merge[o].error=1),console.log(`\n‼️${e}发生错误\n‼️名称: ${t.name}\n‼️描述: ${t.message}${JSON.stringify(t).match(/\"line\"/)?"\n‼️行列: "+JSON.stringify(t):""}${n&&n.status?"\n‼️状态: "+n.status:""}${r?"\n‼️响应: "+(n&&503!=n.status?r:"Omit."):""}`));return{AnError:d,isRequest:o,isJSBox:a,isSurge:t,isQuanX:n,isLoon:r,isNode:i,notify:(e,o,i,s)=>{const l=e=>{if(!e)return e;if("string"==typeof e)return r?e:n?{"open-url":e}:t?{url:e}:void 0;if("object"==typeof e){if(r){return{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]}}if(n){return{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl}}if(t){return{url:e.url||e.openUrl||e["open-url"]}}}};console.log(`${e}\n${o}\n${i}`),n&&$notify(e,o,i,l(s)),t&&$notification.post(e,o,i,l(s)),a&&$push.schedule({title:e,body:o?o+"\n"+i:i})},write:(e,o)=>{if(n)return $prefs.setValueForKey(e,o);if(t)return $persistentStore.write(e,o);if(i)try{l.fs.existsSync(s)||l.fs.writeFileSync(s,JSON.stringify({}));const t=JSON.parse(l.fs.readFileSync(s));return e&&(t[o]=e),e||delete t[o],l.fs.writeFileSync(s,JSON.stringify(t))}catch(e){return d("Node.js持久化写入",null,e)}return a?e?$file.write({data:$data({string:e}),path:`shared://${o}.txt`}):$file.delete(`shared://${o}.txt`):void 0},read:e=>{if(n)return $prefs.valueForKey(e);if(t)return $persistentStore.read(e);if(i)try{if(!l.fs.existsSync(s))return null;return JSON.parse(l.fs.readFileSync(s))[e]}catch(e){return d("Node.js持久化读取",null,e)}return a?$file.exists(`shared://${e}.txt`)?$file.read(`shared://${e}.txt`).string:null:void 0},get:(e,o)=>{e.headers["User-Agent"]="JD4iPhone/167169 (iPhone; iOS 13.4.1; Scale/3.00)",n&&("string"==typeof e&&(e={url:e}),e.method="GET",$task.fetch(e).then((e=>{o(null,c(e),e.body)}),(e=>o(e.error,null,null)))),t&&(e.headers["X-Surge-Skip-Scripting"]=!1,$httpClient.get(e,((e,t,n)=>{o(e,c(t),n)}))),i&&l.request(e,((e,t,n)=>{o(e,c(t),n)})),a&&("string"==typeof e&&(e={url:e}),e.header=e.headers,e.handler=function(e){let t=e.error;t&&(t=JSON.stringify(e.error));let n=e.data;"object"==typeof n&&(n=JSON.stringify(e.data)),o(t,c(e.response),n)},$http.get(e))},post:(e,o)=>{e.headers["User-Agent"]="JD4iPhone/167169 (iPhone; iOS 13.4.1; Scale/3.00)",e.body&&(e.headers["Content-Type"]="application/x-www-form-urlencoded"),n&&("string"==typeof e&&(e={url:e}),e.method="POST",$task.fetch(e).then((e=>{o(null,c(e),e.body)}),(e=>o(e.error,null,null)))),t&&(e.headers["X-Surge-Skip-Scripting"]=!1,$httpClient.post(e,((e,t,n)=>{o(e,c(t),n)}))),i&&l.request.post(e,((e,t,n)=>{o(e,c(t),n)})),a&&("string"==typeof e&&(e={url:e}),e.header=e.headers,e.handler=function(e){let t=e.error;t&&(t=JSON.stringify(e.error));let n=e.data;"object"==typeof n&&(n=JSON.stringify(e.data)),o(t,c(e.response),n)},$http.post(e))},time:()=>{const o=((Date.now()-e)/1e3).toFixed(2);return console.log("\n签到用时: "+o+" 秒")},done:(e={})=>{if(n)return $done(e);t&&(o?$done(e):$done())}}}ReadCookie();
//# sourceMappingURL=/sm/a267e6bdf26ec6f7870d3b66b5fb4be0b1871a844ae2977216f4d954fdb92c9c.map
